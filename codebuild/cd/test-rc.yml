version: 0.2
#this buildspec assumes the ubuntu 14.04 trusty image
# This job is responsible for artifacting the JAR which will have all of the other shared libs stuffed
# into it once all platforms are built and artifacted
phases:

  pre_build:
    commands:
      - cd $CODEBUILD_SRC_DIR/aws-crt-dotnet
      - export CRT_VERSION=$(git describe --abbrev=0 | sed -e s/^v//)

  build:
    commands:
      # Verify that the package can be found on nuget.org, and rebase the tests on it
      # then run them
      - cd $CODEBUILD_SRC_DIR/aws-crt-dotnet
      - mkdir packages
      - dotnet add tests package AWSCRT --version ${CRT_VERSION}-rc
      - dotnet add tests package AWSCRT-HTTP --version ${CRT_VERSION}-rc
      - dotnet build tests --no-dependencies
      - dotnet test tests --no-build -v normal
